let art,the_title,year;function getQuality(t,e,o,s,l){const r=[];return t.source1&&""!==t.source1&&r.push({default:!0,html:"Server UC",url:proxy1+e}),t.source2&&""!==t.source2&&""!==o&&r.push({html:"Torrent",url:proxy2+o}),t.source3&&""!==t.source3&&""!==s&&r.push({html:"Server M4#NM",url:proxy3+s}),t.source4&&""!==t.source4&&r.push({html:"Server M4#N",url:proxy4+l}),r}document.addEventListener("DOMContentLoaded",(async function(){const t=new URLSearchParams(window.location.search),e=t.get("id"),o=t.get("sub");let s="";try{const t=await fetch(`https://db.ply4.com/movies/${e}`);if(t.ok){const e=await t.json();let l=e.title;year=l.match(/\((\d{4})\)$/)[1],the_title=l.replace(/\s*\(\d{4}\)$/,"").trim(),s=e.source1;let r="";if(e.source2&&""!==e.source2){const t=e.source2.replace(/https:\/\/yts.mx\/torrent\/download\/(.+)$/,"https://webtor.io/$1"),o=await fetch(`https://s2.ply4.com/?url=${encodeURIComponent(t)}`);if(o.ok){r=(await o.json()).m3u8Link}}let n="";if(e.source3&&""!==e.source3){const t=await fetch(`https://s3.ply4.com/?url=${encodeURIComponent(e.source3)}`);if(t.ok){n=(await t.json()).m3u8Link}}const i=e.source4,a=getQuality(e,s,r,n,i);art=new Artplayer({container:".rplayer-pro",url:s||r||n||i,setting:!0,fullscreen:!0,playsInline:!0,hotkey:!0,aspectRatio:!0,autoOrientation:!0,autoPlayback:!0,theme:"#0056B3",subtitle:{url:o||"",style:{color:"#fff","font-size":"calc(2vw + 12px)","margin-bottom":"4vw","@media (max-width: 576px)":{"font-size":"14px","margin-bottom":"20px"}}},settings:[{width:200,html:"Subtitle",tooltip:"AutoSubtitle",icon:'<img width="22" height="22" src="https://artplayer.org/assets/img/subtitle.svg">',selector:[{html:"Display",tooltip:"Show",switch:!0,onSwitch:function(t){return t.tooltip=t.switch?"Hide":"Show",art.subtitle.show=!t.switch,!t.switch}},...await fetch("https://cdn.jsdelivr.net/gh/rzmic/ply4/lang.json").then((t=>t.json())).then((t=>t.map((t=>({html:t.name,iso:t.iso,url:""})))))],onSelect:async function(t){try{const e=await fetch(`https://sub.ply4.com/movie/${the_title}/${year}/${t.iso}`),o=await e.json();if(o.subtitles&&o.subtitles.length>0){const e=o.subtitles[o.subtitles.length-1].url;return art.subtitle.switch(subproxy+e,{name:t.html}),t.html}alert("No subtitle found")}catch(e){}}}],plugins:[artplayerPluginHlsQuality({control:!1,setting:!0,getResolution:t=>t.height+"P",title:"Quality",auto:"Auto"}),artplayerPluginChromecast({})],customType:{m3u8:function(t,e,o){if(Hls.isSupported()){o.hls&&o.hls.destroy();const s=new Hls;s.loadSource(e),s.attachMedia(t),o.hls=s,o.on("destroy",(()=>s.destroy()))}else t.canPlayType("application/vnd.apple.mpegurl")?t.src=e:o.notice.show="Unsupported playback format: m3u8"}},quality:a}),document.querySelector(".rplayer-pro").style.display="block",document.querySelector(".loading-container").style.display="none"}else document.querySelector(".loading-container").style.display="none",document.querySelector(".error-message").style.display="flex"}catch(l){document.querySelector(".loading-container").style.display="none",document.querySelector(".error-message").style.display="flex"}}));
